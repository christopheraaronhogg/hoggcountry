---
import BaseLayout from '../layouts/BaseLayout.astro';
import YouTubeEmbed from '../components/YouTubeEmbed.astro';
import IconBadge from '../components/IconBadge.astro';
import Timeline from '../components/Timeline.astro';
import TimelineItem from '../components/TimelineItem.astro';

import { SITE_DESCRIPTION, SITE_TITLE } from '../consts';
import { YT_FEED_URL } from '../lib/config';
import { fetchYouTubeRSS } from '../lib/youtube';
import { getCollection } from 'astro:content';

const trips = (await getCollection('trips')).map(t => ({
  kind: 'trip' as const,
  id: t.id,
  title: t.data.title,
  date: new Date(t.data.date).toISOString(),
  url: `/trips/${t.id}/`,
  meta: {
    state: t.data.state,
    distance_miles: t.data.distance_miles,
    elevation_gain_ft: t.data.elevation_gain_ft,
    difficulty: t.data.difficulty,
  },
}));

const vids = (await fetchYouTubeRSS(YT_FEED_URL)).map(v => ({
  kind: 'video' as const,
  id: v.id,
  title: v.title,
  date: v.published,
  url: `https://www.youtube.com/watch?v=${v.id}`,
}));

const combined = [...trips, ...vids]
  .filter(i => !!i.date)
  .sort((a, b) => +new Date(b.date) - +new Date(a.date))
  .slice(0, 10);

const entries = combined.map((e, idx) => {
  const d = new Date(e.date);
  const dateShort = d.toLocaleDateString(undefined, { month: 'short', day: 'numeric' });
  const dateFull = d.toLocaleDateString(undefined, { year: 'numeric', month: 'long', day: 'numeric' });
  return { ...e, side: (idx % 2 === 0 ? 'left' : 'right') as 'left' | 'right', dateShort, dateFull };
});
---
<BaseLayout title={SITE_TITLE} description={SITE_DESCRIPTION}>
      <section class="hero" style="padding-top:3.5rem;">
        <div class="container">
          <h1 class="font-display">Hogg Country — The Trailhead Logbook</h1>
          <p>I’m an avid hiker based in the great state of Arkansas — Hog Country. My trail name, <strong>Hogg Country Trailblazer</strong>, is a play on my last name, Hogg. I recently received the <strong>Sassafras Award</strong> for becoming a <strong>Triple “O” Crowner</strong>, after thru‑hiking the <strong>Ouachita Trail</strong>, <strong>Ozark Highlands Trail</strong>, and the <strong>Ozark Trail</strong>.</p>
          <div style="margin-top:1rem; display:flex; gap:.75rem; justify-content:center; flex-wrap:wrap;">
            <a class="btn btn-primary" href="#timeline">Jump to Timeline</a>
          </div>
          <div class="chapter font-chapter">Chapter: Pike’s Peak • Colorado</div>
        </div>
      </section>


      <section id="timeline">
        <div class="container" style="position:relative;">
          <Timeline>
            {entries.map((e) => (
              <TimelineItem side={e.side}>
                <Fragment slot="patch">
                  <IconBadge variant={e.kind === 'trip' ? 'trip' : e.kind === 'video' ? 'video' : 'post'} title={e.title} />
                </Fragment>

                <div data-kind={e.kind}>
                  {e.kind === 'trip' ? (
                    <article class="card" style="padding: .75rem 1rem;">
                      <a href={e.url} style="text-decoration:none; color:inherit;">
                        <div class="entry-head">
                          <h3 class="font-display" style="margin:0;">{e.title}</h3>
                          <div class="entry-meta" aria-label={`Date ${e.dateFull}`}>
                            <span>{e.dateShort}</span>
                            {e.meta.state && (<><span class="dot"></span><span>{e.meta.state}</span></>)}
                          </div>
                        </div>
                        <div class="badges" style="margin-top:.35rem;">
                          {e.meta.distance_miles && <span class="badge"><strong>Distance</strong> {e.meta.distance_miles} mi</span>}
                          {e.meta.elevation_gain_ft && <span class="badge"><strong>Gain</strong> {e.meta.elevation_gain_ft} ft</span>}
                          {e.meta.difficulty && <span class="badge"><strong>Diff</strong> {e.meta.difficulty}</span>}
                        </div>
                      </a>
                    </article>
                  ) : (
                    <article class="card video-card" style="padding: .5rem .5rem .6rem;">
                      <div class="video-frame">
                        <YouTubeEmbed id={e.id} title={e.title} />
                      </div>
                      <div style="padding: .35rem .5rem .2rem;">
                        <div class="entry-head">
                          <h3 class="title clamp-2" style="margin:0;">{e.title}</h3>
                          <div class="entry-meta" aria-label={`Date ${e.dateFull}`}>
                            <svg viewBox="0 0 24 24" width="14" height="14" fill="#6b705c" aria-hidden="true" style="margin-right:.25rem;"><path d="M8 5v14l11-7z"/></svg>
                            <span>{e.dateShort}</span>
                            <span class="dot"></span><span>YouTube</span>
                          </div>
                        </div>
                        <div class="actions">
                          <a href={e.url} target="_blank" rel="noopener">Open on YouTube</a>
                        </div>
                      </div>
                    </article>
                  )}
                </div>
              </TimelineItem>
            ))}
          </Timeline>
        </div>
      </section>


      <script>
        const filters = document.getElementById('filters');
        if (filters) {
          filters.addEventListener('click', (e) => {
            const btn = e.target.closest('button.pill');
            if (!btn) return;
            const value = btn.getAttribute('data-filter');
            for (const b of filters.querySelectorAll('button.pill')) {
              b.classList.toggle('is-active', b === btn);
              b.setAttribute('aria-pressed', String(b === btn));
            }
            const items = document.querySelectorAll('.timeline-item .content > [data-kind]');
            items.forEach((node) => {
              const kind = node.getAttribute('data-kind');
              const show = value === 'all' || value === kind;
              const wrapper = node.closest('.timeline-item');
              if (wrapper) {
                wrapper.style.display = show ? '' : 'none';
              }
            });
          });
        }
      </script>
</BaseLayout>

